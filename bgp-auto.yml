name: bgp-lab
mgmt:
  network: bgp
  ipv4-subnet: 172.90.90.0/24
topology:
  nodes:

    rt-ixa:
      kind: nokia_srlinux
      #mgmt-ipv4: 172.80.80.5
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: configs/rt-ixa.cfg 

    rt-ufinet:
      kind: nokia_srlinux
      #mgmt-ipv4: 172.80.80.5
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: configs/rt-ufinet.cfg 

    rt-core:
      kind: linux
      image: quay.io/frrouting/frr:8.4.1
      binds:
        - configs/rt-core-frr.conf:/etc/frr/frr.conf
        - configs/R1-frr-daemons.cfg:/etc/frr/daemons
      exec:
        - "sysctl -w net.ipv6.conf.all.forwarding=1"

    switch-wan:
      kind: nokia_srlinux
      #mgmt-ipv4: 172.80.80.5
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: configs/switch-wan.cfg 

    srvweb:
       kind: linux
       image: docker.io/esanchezv/srvhttps:latest
       binds:
        #- configs/web-server.html:/var/www/localhost/htdocs/index.html
       exec:
        - ip -6 route del default dev eth0
            
    
    srlswitch:
      kind: nokia_srlinux
      #mgmt-ipv4: 172.80.80.5
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: configs/srlswitch.cfg 
    
    
    rt-slas-core:
      kind: cisco_iol
      image: arthurk99/cisco-iol:17.15.01 
      
    wan1:
      kind: linux
      image: bprodoehl/wan-emulator:20230418
      #mgmt-ipv4: 172.20.20.11
      binds:
        - configs/crea-bridge.sh:/root/crea-bridge.sh
      exec:
        - chmod +x /root/crea-bridge.sh
        - bash /root/crea-bridge.sh    
      
    wan2:
      kind: linux
      image: bprodoehl/wan-emulator:20230418
      #mgmt-ipv4: 172.20.20.12
      binds:
        - configs/crea-bridge.sh:/root/crea-bridge.sh
      exec:
        - chmod +x /root/crea-bridge.sh
        - bash /root/crea-bridge.sh    

    PC-corpo:
      kind: linux
      image: esanchezv/kaliipv6:latest
      exec:
        - ip -6 address add 2001:db8:ca01::2/64 dev eth1
        - ip -6 route del default dev eth0
        - ip -6 route add default via 2001:db8:ca01::1

    #PC-cliente:
      #kind: linux
      #image: esanchezv/kaliipv6:latest
   
  links:
    - endpoints: ["rt-ixa:e1-1", "wan1:eth1"]
    - endpoints: ["rt-ufinet:e1-1", "wan2:eth1"]
    - endpoints: ["wan1:eth2", "rt-core:eth1"]
    - endpoints: ["wan2:eth2", "rt-core:eth2"]
    - endpoints: ["rt-core:eth3", "srlswitch:e1-1"]
    - endpoints: ["PC-corpo:eth1", "srlswitch:e1-2"]
    - endpoints: ["rt-slas-core:Ethernet0/1", "srlswitch:e1-3"] 
    - endpoints: ["rt-ixa:e1-2", "switch-wan:e1-1"]
    #- endpoints: ["rt-ufinet:e1-2", "switch-wan:e1-2"]
    - endpoints: ["srvweb:eth1", "switch-wan:e1-3"]
