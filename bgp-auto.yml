name: bgp-lab
mgmt:
  network: isp-bgp
  ipv4-subnet: 172.90.90.0/24

topology:
  nodes:

    rt-ixa:
      kind: nokia_srlinux
      #mgmt-ipv4: 172.80.80.5
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: configs/rt-ixa.cfg 

    rt-ufinet:
      kind: nokia_srlinux
      #mgmt-ipv4: 172.80.80.5
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: configs/rt-ufinet.cfg 

    rt-core:
      kind: huawei_vrp
      mgmt-ipv4: 172.90.90.7
      image: vrnetlab/huawei_vrp:ne40e-8.180
      startup-config: configs/myconfig.txt
      
    switch-wan:
      kind: cisco_iol
      #mgmt-ipv4: 172.80.80.5
      image: arthurk99/cisco-iol-l2:17.15.01 
      type: L2
      #startup-config: configs/myconfig.txt 

    srvweb:
       kind: linux
       image: docker.io/esanchezv/srvhttps:latest
       binds:
        #- configs/web-server.html:/var/www/localhost/htdocs/index.html
       #exec:
         #- ip -6 route del default dev eth0

    srv-cloudflare:
       kind: linux
       image: docker.io/esanchezv/srvhttps:latest 
       exec:
        - ip -6 address add 2001:db8:4444::100/64 dev eth1
        - ip -6 route add default via 2001:db8:4444::1

    srv-google:
       kind: linux
       image: docker.io/esanchezv/srvhttps:latest
       exec:
        - ip -6 address add 2001:db8:8888::100/64 dev eth1
        - ip -6 route add default via 2001:db8:8888::1
    
    srlswitch:
      kind: nokia_srlinux
      #mgmt-ipv4: 172.80.80.5
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: configs/srlswitch.cfg 
    
          
    wan1:
      kind: linux
      image: docker.io/esanchezv/srvhttps:latest
      binds:
        - configs/crea-bridge.sh:/root/crea-bridge.sh
      exec:
        - chmod +x /root/crea-bridge.sh
        - bash /root/crea-bridge.sh   
      
    wan2:
      kind: linux
      image: docker.io/esanchezv/srvhttps:latest
      binds:
        - configs/crea-bridge.sh:/root/crea-bridge.sh
      exec:
        - chmod +x /root/crea-bridge.sh
        - bash /root/crea-bridge.sh   

    wan-google:
      kind: linux
      image: docker.io/esanchezv/srvhttps:latest
      binds:
        - configs/crea-bridge.sh:/root/crea-bridge.sh
      exec:
        - chmod +x /root/crea-bridge.sh
        - bash /root/crea-bridge.sh   

    wan-cloudflare:
      kind: linux
      image: docker.io/esanchezv/srvhttps:latest
      binds:
        - configs/crea-bridge.sh:/root/crea-bridge.sh
      exec:
        - chmod +x /root/crea-bridge.sh
        - bash /root/crea-bridge.sh   

    PC-corpo:
      kind: linux
      image: esanchezv/kaliipv6:latest
      exec:
        - ip -6 address add 2001:db8:ca01::2/64 dev eth1
        #- ip -6 route del default dev eth0
        - ip -6 route add default via 2001:db8:ca01::1

    nornir:
      kind: linux
      image: esanchezv/kali-python3:latest 
      binds:
       - configs/nornir.sh:/root/nornir.sh
       - configs/nornir/automation:/root/automation
      exec:
       - python3 -m pip config set global.break-system-packages true
       - chmod +x /root/nornir.sh
       - bash /root/nornir.sh    
       #- ip -6 address add 2001:db8:ca01::100/64 dev eth1 
       #- ip -6 route add default via 2001:db8:ca01::1

    grafana:
      kind: linux
      mgmt-ipv4: 172.90.90.43
      image: grafana/grafana:12.0.2
      binds:
        
        - configs/grafana/dashboards.yml:/etc/grafana/provisioning/dashboards/dashboards.yaml:ro
        - configs/grafana/datasource.yml:/etc/grafana/provisioning/datasources/datasource.yaml:ro
        #- configs/grafana/dashboards:/var/lib/grafana/dashboards
      ports:
        - 3000:3000
      env:
        # GF_INSTALL_PLUGINS: "yesoreyeram-infinity-datasource"
        # env vars to enable anonymous access
        GF_ORG_ROLE: "Admin"
        GF_ORG_NAME: "Main Org"
        GF_AUTH_ANONYMOUS_ENABLED: "true"
        GF_AUTH_ANONYMOUS_ORG_ROLE: Admin
        GF_AUTH_ANONYMOUS: "true"
        GF_AUTH_OAUTH_AUTO_LOGIN: "true"
        
     
    elastic:
      kind: linux
      mgmt-ipv4: 172.90.90.9
      image: docker.elastic.co/elasticsearch/elasticsearch:7.17.7
      
      env:
        node.name: es01
        discovery.type: single-node
        #xpack.security.enabled: "true"
        #xpack.security.audit.enabled: "true"
        #xpack.security.authc.api_key.enabled: "true"
        ES_JAVA_OPTS: "-Xms1g -Xmx1g"
      ports:
        - 9200:9200/tcp   
   
  links:
    - endpoints: ["rt-ixa:e1-1", "wan1:eth1"]
    - endpoints: ["rt-ufinet:e1-1", "wan2:eth1"]
    - endpoints: ["wan1:eth2", "rt-core:eth1"]
    - endpoints: ["wan2:eth2", "rt-core:eth2"]
    - endpoints: ["rt-core:eth3", "srlswitch:e1-1"]
    - endpoints: ["PC-corpo:eth1", "srlswitch:e1-2"]
    - endpoints: ["nornir:eth1", "srlswitch:e1-3"] 
    - endpoints: ["rt-ixa:e1-2", "switch-wan:eth1"]
    - endpoints: ["rt-ufinet:e1-2", "switch-wan:eth2"]
    - endpoints: ["srvweb:eth1", "switch-wan:eth3"]
    - endpoints: ["rt-ufinet:e1-3", "wan-cloudflare:eth1"]
    - endpoints: ["wan-cloudflare:eth2", "srv-cloudflare:eth1"]
    - endpoints: ["rt-ixa:e1-3", "wan-google:eth1"]
    - endpoints: ["wan-google:eth2", "srv-google:eth1"]
     

   
   
